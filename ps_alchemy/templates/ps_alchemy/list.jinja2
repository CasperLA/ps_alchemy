{% extends "sacrud/redefineme.jinja2" %}

{% set table=context.table %}

{% block title %} - list of {{ _(table.verbose_name or table.__tablename__) }}{% endblock %}

{% block popup_content %}
  <h4>{{ _ps('Are you sure you want to delete an object?') }}</h4>
{% endblock %}
{% block popup_footer %}
  <a href="#!" id="delete-confirm" class="modal-action modal-close btn green">
    {{ _ps('Confirm') }}
  </a>
  <a href="#!" class="cancel-button modal-action modal-close red btn">{{ _ps('Cancel') }}</a>
{% endblock %}

{% block body %}
  {% if hasattr(table, 'sacrud_list_col') %}
    {% set visible_columns=table.sacrud_list_col %}
  {% else %}
    {% set visible_columns=table.__table__.c %}
  {% endif %}
  {% if table.sacrud_list_template %}
    {% include table.sacrud_list_template with context %}
  {% else %}
    <h4>{{ _(table.verbose_name or table.__tablename__) }}</h4>
    <a class="create-button btn waves-effect waves-light"
      href="/{{ request.sacrud_prefix }}/{{ request.resource_path(context.get_create_resource()) }}">
      <i class="material-icons left">add_circle_outline</i>
      {{ _ps('Create') }}
    </a>
    <a class="delete-button waves-effect waves-light btn red">
      <i class="material-icons left">remove_circle_outline</i>
      {{ _ps('Delete') }}
    </a>

    <div class="container"><br/></div>
    <form id="sacrud-form" method="post"
      action="/{{ request.sacrud_prefix }}/{{ request.resource_path(context.get_mass_action_resource()['delete']) }}">
      <table class="bordered highlight hoverable z-depth-1">
        {% if paginator.items.__len__() > 0 %}
          <thead>
            <tr class="blue lighten-5">
              <th>
                <input id="select_all_item" type="checkbox" />
                <label for="select_all_item"></label>
              </th>
              <th></th>
              {% for col in visible_columns %}
                <th>
                  {{ _(col.info.verbose_name or col.name or col.sacrud_name or None) }}
                </th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
          {% for row in paginator %}
            <tr id="{{ table.__tablename__ }}_{{ pk_to_list(row) }}">
              <td width="1">
                <input id="{{ pk_to_list(row, True) }}"
                type="checkbox" name="selected_item" value="{{ pk_to_list(row, True) }}" />
                <label for="{{ pk_to_list(row, True) }}"></label>
              </td>
              <td width="1">
                <a href="/{{ request.sacrud_prefix }}/{{ request.resource_path(context.get_update_resource(row)) }}">
                  <i class="material-icons left">edit</i>
                </a>
              </td>
              {% for col in visible_columns %}
                <td>
                  {% if col.__class__.__name__ in ['Column', 'InstrumentedAttribute'] %}
                    {% set col_value=row.__getattribute__(get_attrname_by_colname(row, col.name)) %}
                  {% endif %}
                  {% if col.info['sacrud_list_template'] %}
                    {% include col.info['sacrud_list_template'] %}
                  {% elif col.info['sacrud_list_content'] %}
                    {% if col.safe %}
                      {{ col.info['sacrud_list_content'](row)|safe }}
                    {% else %}
                      {{ col.info['sacrud_list_content'](row) }}
                    {% endif %}
                  {% else %}
                    {{ col_value|string|truncate(200) }}
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
          </tbody>
        {% else %}
          <tr>
            <td>There are no objects</td>
          </tr>
        {% endif %}
      </table>
      <input id="mass-action" type="hidden" value="0" name="mass_action" />
    </form>
    {% if paginator.items.__len__() >= 1 and paginator.page_count > 1 %}
      {% include "ps_alchemy/paginator.jinja2" %}
    {% endif %}
  {% endif %}
{% endblock %}
